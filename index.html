
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mobile AR.js Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ar.js@4.3.2/aframe/build/aframe-ar.js"></script>
<style>
  body { margin:0; overflow:hidden; background:#111; color:white; text-align:center; }
  #startButton {
    font-size: 22px; padding:15px 30px; margin-top: 30%; cursor:pointer;
    border:none; border-radius:8px; background: #0af; color:white;
  }
</style>
</head>
<body>
<h2>Click to Start AR</h2>
<button id="startButton">Start AR</button>
<div id="arContainer" style="width:100%; height:100%; display:none;"></div>

<script>
const startBtn = document.querySelector('#startButton');
const container = document.querySelector('#arContainer');

startBtn.addEventListener('click', async () => {
  startBtn.style.display = 'none';
  container.style.display = 'block';

  // Manually request camera permission first
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
    const video = document.createElement('video');
    video.srcObject = stream;
    video.autoplay = true;
    video.muted = true;
    video.playsInline = true;
    container.appendChild(video);

    // Now initialize A-Frame + AR.js scene after camera is active
    const scene = document.createElement('a-scene');
    scene.setAttribute('embedded', '');
    scene.setAttribute('vr-mode-ui', 'enabled: false');
    scene.setAttribute('renderer', 'alpha: true; antialias: true');
    scene.setAttribute('arjs', 'trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix');
    container.appendChild(scene);

    // Add camera
    const camera = document.createElement('a-entity');
    camera.setAttribute('camera', '');
    scene.appendChild(camera);

    // Business card marker
    const marker = document.createElement('a-marker');
    marker.setAttribute('type', 'pattern');
    marker.setAttribute('url', 'img/business-card.patt');

    // Avatar
    const avatar = document.createElement('a-entity');
    avatar.setAttribute('gltf-model', 'model/avatar.glb');
    avatar.setAttribute('scale', '0.4 0.4 0.4');
    avatar.setAttribute('position', '0 0 0');
    avatar.setAttribute('rotation', '0 180 0');
    avatar.setAttribute('animation', 'property: rotation; to: 0 190 0; dir: alternate; dur: 2000; loop: true');
    marker.appendChild(avatar);

    // Website button
    const websiteBtn = document.createElement('a-entity');
    websiteBtn.setAttribute('gltf-model', 'model/button_website.glb');
    websiteBtn.setAttribute('scale', '0.15 0.15 0.15');
    websiteBtn.setAttribute('position', '-0.4 0 0');
    websiteBtn.setAttribute('rotation', '0 180 0');
    websiteBtn.addEventListener('click', () => window.open('https://yourwebsite.com', '_blank'));
    marker.appendChild(websiteBtn);

    // LinkedIn button
    const linkedinBtn = document.createElement('a-entity');
    linkedinBtn.setAttribute('gltf-model', 'model/button_linkedin.glb');
    linkedinBtn.setAttribute('scale', '0.15 0.15 0.15');
    linkedinBtn.setAttribute('position', '0.4 0 0');
    linkedinBtn.setAttribute('rotation', '0 180 0');
    linkedinBtn.addEventListener('click', () => window.open('https://linkedin.com/in/yourprofile', '_blank'));
    marker.appendChild(linkedinBtn);

    scene.appendChild(marker);

    // Fallback Hiro marker
    const fallback = document.createElement('a-marker');
    fallback.setAttribute('preset', 'hiro');
    const fallbackBox = document.createElement('a-box');
    fallbackBox.setAttribute('position', '0 0.5 0');
    fallbackBox.setAttribute('scale', '0.5 0.5 0.5');
    fallbackBox.setAttribute('color', 'blue');
    fallback.appendChild(fallbackBox);
    scene.appendChild(fallback);

  } catch(e) {
    alert("Camera access denied or not supported on this device.");
    console.error(e);
  }
});
</script>
</body>
</html>
